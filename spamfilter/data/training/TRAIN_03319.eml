a deadlock problemHi XFS developers  When studying xfs code          I found that the inode will be locked by  XFS ILOCK SHARE flags before we get acl  which may cause deadlock  Because when getting acl  it will allocate memory in KM SLEEP  If the  memory is tight  the process will call xfs strategy  and may  lock XFS ILOCK SHARE the same inode again  If between these two locks   another process try to lock the inode by XFS ILOCK EXCL  these two  processes  will be deadlock  As follows       A process get ea                         B process want lock ipA     xfs ilock ipA  XFS ILOCK SHARE                                                                                                                                                             get acl                           xfs ilock ipA  XFS ILOCK EXCL                                                                                                                          memory tight                                     xfs stragegy                               xfs ilock ipA  XFS ILOCK SHARE                                         these two processes will be dead lock   So I believe that acl allocation GFP MASKshould be changed to KM NOFS  right   best regards                                                  wdd     