Re  kernel BUG at filemap c     I did more testing with your patch on top of today s CVS  but the patch didn t help at all  The following is the results of the tests   Testing setup     created a   dev md   with   scsi disks    created a LVM Volume group  vg  with the   dev md      created a LVM logical volume  vol   with  vg     created a XFS fs with a command      mkfs xfs  f  d sunit   swidth    dev vg vol                 meta data  dev vg vol            isize        agcount    agsize       blks                data                             bsize        blocks         imaxpct                                                    sunit        swidth   blks  unwritten                  naming    version                bsize                     log       internal log           bsize        blocks       version                                                   sunit   blks                realtime  none                   extsz        blocks    rtextents    Test results     mount with quota enabled    occasional kernel oops  attached the file oops     mount without quota enabled    occasional kernel oops  attached the file oops     mount without quota enabled  while md device is in degraded mode    always kernel oops  attached the file oops   Thanks   JLee        Original Message       From   Eric Sandeen    To   James Lee    Cc       Sent  Tuesday  August               PM Subject  Re  kernel BUG at filemap c          Hi guys       We treat MD and LVM somewhat specially  and I wonder if in this case MD   is masking the fact that you re using LVM  and that might be where the   problem starts      Can you try this patch  which will cause LVM   MD to be treated the   same  to see if it helps   It s probably not the final solution  but it   might offer some hints      Thanks       Eric         linux fs xfs pagebuf page buf locking c      Tue Aug                        linux fs xfs pagebuf page buf locking c Tue Aug                                            pagebuf target blocksize target  PAGE CACHE SIZE         if   MAJOR dev     MD MAJOR      MAJOR dev     EVMS MAJOR       target  pbr flags   PBR ALIGNED ONLY      target  pbr flags   PBR SECTOR ONLY      else if  MAJOR dev     LVM BLK MAJOR      target  pbr flags   PBR SECTOR ONLY      else         On Mon             at        James Lee wrote      Hi          I m also having the exactly same problem      Tested with        xfs checked out from SGI s CVS on Aug     on Redhat          Kernel and userland tools are compiled with gcc             The following is the result of some tests          scsidisks    xfs  OK     scsidisks    raid     xfs  OK     scsidisks    lvm    xfs  OK     scsidisks    raid     lvm    xfs  OK     scsidisks    raid     lvm    xfs  OK     scsidisks    raid     lvm    xfs  kernel BUG at filemap c              This problem is always reproducible with the following shell script                     bin sh             mkraid  dev md              vgcreate VolumeGroup  dev md              lvcreate  L G  nTestVolume VolumeGroup             mkfs xfs  f  d size   m  dev VolumeGroup TestVolume             mount  t xfs  dev VolumeGroup TestVolume      mnt  onoatime nodiratime usrquota grpquota         Whenever I run the above script  mount command always generates kernel oops      But  if I insert some delay as of the following  then mount goes well             Eric Sandeen      XFS for Linux             SGI  Inc                         begin     oops  dat M   S   D B R C N  DM   S  A  TDG   E   E   O B T W   V   M          O   T  UE  UO W S   N  XQ   N  DV     BXT C Y B   W T   N   T M  TN   P   N  XQ   H   F   L  D  E A  UB VP   YF W M   I VXN     M   I  P    S  UE   H      AE  QO R M   C   S   H   K   N  P  M  YD  UO   L      AA   A  UO W S  UT   L C R  DS     M       X  I  DQ  U Z   P   P C V F A    Y   B         M   P V W   T       X B P   P   Q B     D  H    P   P       I M B C   P   C R     D   F F C     E G Z   P   P   Q     M   P B F   D  DY  ID  MA R Q     E R   E R C   T C X       S W E     G F S E V P M  I    S W E   S BLX   C  X    A V     P C B   T  QX G   VUO  YT M G K     T  U  V L  LS R S  X  V D  L    P   B   V  QU FQO VM  M   F F F F A      E W   V D  L    P M   B   C  QU FQO VM    H   S  DL   A  I  V E R   S Q M F D       N   C U P   E S Q S   S  A  TDG   T  T  VET   Q   T   E F B   D M   C   S  UF  UD   U FET     U   A B G       R   A V U   L  EN    S   D M           P   P   V       X B P   P   P  IE   S M V U  MS   T S B R B     E R   E R C   F   Y       S W M W U M W A VAE VLK SDO   P  I    S VUO  YT M G K C B S P     E R   E R C   S S B B     S W E   S BLS B C M  X    A V     P C S S P  QX G         U G K   O M   P  I   I  V E R   S Q F D  D    N   C U P   E S Y S  DL   C  I  V E R   S Q F D       N   C U P   E S C S   R       P M   P   A  I  V E R   S Q F D       N   C U P   E S E S  PP   H   S  D  V D  L    P   B   T  QU FQO VM    P B C   R F F B    YL V K W A V K C O S   D O M       C   R F E B    YL V K W A V K   O S   B     Z         M                               P W         B  I  V E R   S Q M F D    I  V E R   S Q F D M  D    N   C U P   E S Y S   R            H  B W   N  YG   N      S  A  TDG   E   E   O B T W   V   M          H  QE  U   ES  EN   E W A   D  UO    M   E F R   E   S  UF  UD   U FET    UO W S  T   T  M  T   T   T   T   T   IK  US  AD   A  QT  H       UL   P  UB VP    T  QL  YG  UE M   H   K   N  P  F R  US   T RX   MS  UO W S  UH   X  H    P   P     M   E   Z   P   P   P F S   C   A S     E  DZ   F  EE   P M       P B P   P   P       S  MA R Q     E R   E R C   T C X       S W E   S BLR   C M  X    A V     P C B   E  QX G   VUO  YT G K V E S Q  X    A M V     P C C   B  QX G     U G K   O C   E R   E R C   T   R M B    EN F S W E           U G K   O   P  I   I  V E R   S Q F D  D    N   C U P   E M S Y S  DL   C  I  V E R   S Q F D       N M   C U P   E S C S   R       P   P   A  I  V E R   S Q F D       N   C M U P   E S E S  PP   H   S  D  V D  L    P   B   T  QU M FQO VM    P B C   R F F B    YL V K M W A V K C O S   D O       C   R F E B    YL V K W A V K   O M S   B     Z                                       P W       M   B  I  V E R   S Q F D    I  V E R   S Q F D  D    N   C U P   E S Y S   R           M  H   T   T   T   T   T   T   T   T   T   T   T   T   T   T     T   T   T   H    end  